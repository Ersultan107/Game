<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Maze: Chill Edition</title>
    <style>
        :root {
            --neon-color: #00f3ff;
            --wall-color: #1a1a2e;
            --bg-color: #0f0f1b;
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background: var(--bg-color);
            color: white; font-family: 'Segoe UI', sans-serif;
            overflow: hidden; touch-action: none;
        }

        #ui-layer {
            position: absolute; top: 20px; width: 100%; text-align: center;
            z-index: 5; pointer-events: none;
        }

        canvas { display: block; background: var(--bg-color); }

        /* –°—Ç–∏–ª–∏ –¥–∂–æ–π—Å—Ç–∏–∫–∞ */
        #joystick-container {
            position: absolute; bottom: 50px; left: 50%;
            transform: translateX(-50%);
            width: 120px; height: 120px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid var(--neon-color);
            border-radius: 50%;
            z-index: 10;
        }

        #joystick-knob {
            position: absolute; top: 30px; left: 30px;
            width: 60px; height: 60px;
            background: var(--neon-color);
            border-radius: 50%;
            box-shadow: 0 0 20px var(--neon-color);
        }

        /* –°–∫—Ä–∏–º–µ—Ä */
        #screamer {
            display: none; position: fixed; top: 0; left: 0;
            width: 100vw; height: 100vh; background: black; z-index: 9999;
        }
        #screamer img { width: 100%; height: 100%; object-fit: cover; }

        .start-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-color); z-index: 20;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; padding: 20px;
        }

        .btn {
            padding: 15px 40px; background: var(--neon-color);
            color: black; border: none; border-radius: 30px;
            font-weight: bold; font-size: 1.2rem; cursor: pointer;
            box-shadow: 0 0 20px var(--neon-color);
        }
    </style>
</head>
<body>

<div id="ui-layer">
    <div id="lvl-display">–£—Ä–æ–≤–µ–Ω—å: 1 / 5</div>
</div>

<div class="start-screen" id="start-screen">
    <h1 style="color: var(--neon-color)">NEON MAZE</h1>
    <p>–î–æ–π–¥–∏ –¥–æ —Ñ–∏–æ–ª–µ—Ç–æ–≤–æ–π –∑–æ–Ω—ã.<br>–í–∫–ª—é—á–∏ –∑–≤—É–∫ –Ω–∞ –º–∞–∫—Å–∏–º—É–º –¥–ª—è –ø–æ–≥—Ä—É–∂–µ–Ω–∏—è –≤ –∞—Ç–º–æ—Å—Ñ–µ—Ä—É üéß</p>
    <button class="btn" onclick="startGame()">–ò–ì–†–ê–¢–¨</button>
</div>

<canvas id="gameCanvas"></canvas>

<div id="joystick-container">
    <div id="joystick-knob"></div>
</div>

<div id="screamer">
    <img src="screamer.jpg">
</div>

<audio id="bg-audio" src="bg-music.mp3" loop></audio>
<audio id="scream-audio" src="scream.mp3"></audio>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const bgAudio = document.getElementById('bg-audio');
    const screamAudio = document.getElementById('scream-audio');
    const screamerDiv = document.getElementById('screamer');

    let level = 1;
    let player = { x: 50, y: 50, radius: 10 };
    let finish = { x: 0, y: 0, size: 30 };
    let walls = [];
    let joystick = { x: 0, y: 0, active: false };

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ –ø–æ–¥ —ç–∫—Ä–∞–Ω
    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        initLevel();
    }

    function startGame() {
        document.getElementById('start-screen').style.display = 'none';
        bgAudio.volume = 0.5;
        bgAudio.play();
        resize();
        animate();
    }

    function initLevel() {
        player.x = 40;
        player.y = 40;
        walls = [];
        
        // –†–∏—Å—É–µ–º –≥—Ä–∞–Ω–∏—Ü—ã –∏ —Å—Ç–µ–Ω—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Ä–æ–≤–Ω—è
        if (level === 1) {
            walls.push({x: 0, y: 100, w: canvas.width - 100, h: 20});
            finish = {x: canvas.width - 50, y: canvas.height - 150};
        } else if (level === 5) {
            // –°–∞–º—ã–π —Å–ª–æ–∂–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
            walls.push({x: 100, y: 0, w: 20, h: canvas.height - 100});
            walls.push({x: 200, y: 100, w: 20, h: canvas.height});
            finish = {x: canvas.width - 40, y: 50};
        } else {
            walls.push({x: 100, y: 100, w: 200, h: 20});
            finish = {x: canvas.width - 60, y: canvas.height - 100};
        }
    }

    // –õ–æ–≥–∏–∫–∞ –¥–∂–æ–π—Å—Ç–∏–∫–∞
    const knob = document.getElementById('joystick-knob');
    window.addEventListener('touchstart', e => {
        const touch = e.touches[0];
        const rect = document.getElementById('joystick-container').getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;
        
        if (Math.hypot(touch.clientX - centerX, touch.clientY - centerY) < 100) {
            joystick.active = true;
        }
    });

    window.addEventListener('touchmove', e => {
        if (!joystick.active) return;
        const touch = e.touches[0];
        const rect = document.getElementById('joystick-container').getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;
        
        let dx = touch.clientX - centerX;
        let dy = touch.clientY - centerY;
        const dist = Math.hypot(dx, dy);
        
        if (dist > 30) {
            dx = (dx / dist) * 30;
            dy = (dy / dist) * 30;
        }
        
        knob.style.transform = `translate(${dx}px, ${dy}px)`;
        joystick.x = dx / 15;
        joystick.y = dy / 15;
    });

    window.addEventListener('touchend', () => {
        joystick.active = false;
        joystick.x = 0; joystick.y = 0;
        knob.style.transform = `translate(0px, 0px)`;
    });

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // –°—Ç–µ–Ω—ã
        ctx.fillStyle = '#1a1a2e';
        walls.forEach(w => ctx.fillRect(w.x, w.y, w.w, w.h));
        
        // –§–∏–Ω–∏—à
        ctx.fillStyle = '#bc13fe';
        ctx.shadowBlur = 15; ctx.shadowColor = '#bc13fe';
        ctx.fillRect(finish.x, finish.y, finish.size, finish.size);
        
        // –ò–≥—Ä–æ–∫
        ctx.fillStyle = varColor();
        ctx.shadowBlur = 20; ctx.shadowColor = varColor();
        ctx.beginPath();
        ctx.arc(player.x, player.y, player.radius, 0, Math.PI*2);
        ctx.fill();
        ctx.shadowBlur = 0;
    }

    function varColor() { return level === 5 ? '#ff003c' : '#00f3ff'; }

    function update() {
        if (!joystick.active) return;
        
        let nextX = player.x + joystick.x;
        let nextY = player.y + joystick.y;

        // –ö–æ–ª–ª–∏–∑–∏–∏ —Å–æ —Å—Ç–µ–Ω–∞–º–∏
        let hit = false;
        walls.forEach(w => {
            if (nextX + 10 > w.x && nextX - 10 < w.x + w.w &&
                nextY + 10 > w.y && nextY - 10 < w.y + w.h) {
                hit = true;
            }
        });

        if (!hit) {
            player.x = nextX;
            player.y = nextY;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–Ω–∏—à–∞
        if (Math.hypot(player.x - (finish.x + 15), player.y - (finish.y + 15)) < 20) {
            if (level < 5) {
                level++;
                document.getElementById('lvl-display').innerText = `–£—Ä–æ–≤–µ–Ω—å: ${level} / 5`;
                initLevel();
            } else {
                triggerScreamer();
            }
        }
    }

    function triggerScreamer() {
        bgAudio.pause();
        screamAudio.volume = 1.0;
        screamAudio.play();
        screamerDiv.style.display = 'block';
        if (navigator.vibrate) navigator.vibrate([1000, 500, 2000]);
        document.documentElement.requestFullscreen();
    }

    function animate() {
        update();
        draw();
        requestAnimationFrame(animate);
    }

    window.addEventListener('resize', resize);
</script>

</body>
</html>
