<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEON MAZE: ULTIMATE CHILL</title>
    <style>
        :root {
            --neon-blue: #00f3ff;
            --neon-purple: #bc13fe;
            --bg-dark: #050508;
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background: var(--bg-dark);
            color: white; font-family: 'Segoe UI', Roboto, sans-serif;
            overflow: hidden; touch-action: none;
        }

        /* –§–æ–Ω–æ–≤–∞—è —Å–µ—Ç–∫–∞ –¥–ª—è –∫—Ä–∞—Å–æ—Ç—ã */
        #grid-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: linear-gradient(rgba(0, 243, 255, 0.05) 1px, transparent 1px),
                              linear-gradient(90deg, rgba(0, 243, 255, 0.05) 1px, transparent 1px);
            background-size: 30px 30px;
            z-index: 0;
        }

        #ui-layer {
            position: absolute; top: 30px; width: 100%; text-align: center;
            z-index: 5; pointer-events: none;
            text-transform: uppercase; letter-spacing: 2px;
            text-shadow: 0 0 10px var(--neon-blue);
        }

        canvas { display: block; position: relative; z-index: 1; }

        /* –î–∂–æ–π—Å—Ç–∏–∫ */
        #joystick-container {
            position: absolute; bottom: 40px; left: 50%;
            transform: translateX(-50%);
            width: 100px; height: 100px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--neon-blue);
            border-radius: 50%;
            z-index: 10;
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.1);
        }

        #joystick-knob {
            position: absolute; top: 25px; left: 25px;
            width: 50px; height: 50px;
            background: var(--neon-blue);
            border-radius: 50%;
            box-shadow: 0 0 20px var(--neon-blue);
            transition: transform 0.05s linear;
        }

        /* –≠–∫—Ä–∞–Ω —Å—Ç–∞—Ä—Ç–∞ */
        .start-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-dark); z-index: 100;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; padding: 20px; box-sizing: border-box;
        }

        .btn {
            padding: 18px 50px; background: transparent;
            color: var(--neon-blue); border: 2px solid var(--neon-blue);
            border-radius: 5px; font-weight: bold; font-size: 1.1rem;
            cursor: pointer; box-shadow: 0 0 15px var(--neon-blue);
            text-transform: uppercase; transition: 0.3s;
        }

        .btn:active { background: var(--neon-blue); color: black; }

        /* –°–∫—Ä–∏–º–µ—Ä */
        #screamer {
            display: none; position: fixed; top: 0; left: 0;
            width: 100vw; height: 100vh; background: black; z-index: 9999;
        }
        #screamer img { width: 100%; height: 100%; object-fit: cover; }
    </style>
</head>
<body>

<div id="grid-bg"></div>

<div id="ui-layer">
    <div id="lvl-display" style="font-size: 1.2rem;">Sync Level: <span id="cur-lvl">1</span> / 5</div>
</div>

<div class="start-screen" id="start-screen">
    <h1 style="color: var(--neon-blue); font-size: 2.5rem; margin-bottom: 10px;">NEON MAZE</h1>
    <p style="color: #888; margin-bottom: 30px; line-height: 1.5;">
        –î–æ–≤–µ–¥–∏ —Å—Ñ–µ—Ä—É –¥–æ —Ñ–∏–æ–ª–µ—Ç–æ–≤–æ–≥–æ –ø–æ—Ä—Ç–∞–ª–∞.<br>
        <span style="color: #fff;">üéß –í–∫–ª—é—á–∏ –∑–≤—É–∫ –Ω–∞ –º–∞–∫—Å–∏–º—É–º –¥–ª—è –ø–æ–≥—Ä—É–∂–µ–Ω–∏—è.</span>
    </p>
    <button class="btn" onclick="startGame()">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>
</div>

<canvas id="gameCanvas"></canvas>

<div id="joystick-container">
    <div id="joystick-knob"></div>
</div>

<div id="screamer">
    <img src="screamer.jpg">
</div>

<audio id="bg-audio" src="bg-music.mp3" loop></audio>
<audio id="scream-audio" src="scream.mp3"></audio>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const bgAudio = document.getElementById('bg-audio');
    const screamAudio = document.getElementById('scream-audio');
    const screamerDiv = document.getElementById('screamer');

    let level = 1;
    let player = { x: 50, y: 50, radius: 12 };
    let finish = { x: 0, y: 0, size: 40 };
    let walls = [];
    let joystick = { x: 0, y: 0, active: false };
    let pulse = 0;

    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        initLevel();
    }

    function startGame() {
        document.getElementById('start-screen').style.display = 'none';
        bgAudio.volume = 0.6;
        bgAudio.play();
        resize();
        animate();
    }

    function initLevel() {
        player.x = 50;
        player.y = 100;
        walls = [];
        
        // –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ñ–∏–Ω–∏—à–∞, —á—Ç–æ–±—ã –≤—Å–µ–≥–¥–∞ –±—ã–ª–∏ –Ω–∞ –≤–∏–¥—É
        const W = canvas.width;
        const H = canvas.height;

        if (level === 1) {
            walls.push({x: 0, y: H/2, w: W * 0.7, h: 20});
            finish = {x: W - 70, y: H - 150};
        } else if (level === 2) {
            walls.push({x: W * 0.3, y: 0, w: 20, h: H * 0.7});
            finish = {x: W - 80, y: 100};
        } else if (level === 3) {
            walls.push({x: 0, y: 200, w: W - 100, h: 20});
            walls.push({x: 100, y: 400, w: W, h: 20});
            finish = {x: 50, y: H - 100};
        } else if (level === 4) {
            walls.push({x: W/2, y: 0, w: 20, h: H});
            finish = {x: W - 80, y: H/2};
        } else if (level === 5) {
            // –§–ò–ù–ê–õ–¨–ù–´–ô –£–†–û–í–ï–ù–¨ - –æ—á–µ–Ω—å —É–∑–∫–∏–π –ø—Ä–æ—Ö–æ–¥
            walls.push({x: 0, y: 150, w: W - 60, h: 20});
            walls.push({x: 60, y: 300, w: W, h: 20});
            finish = {x: W - 70, y: 215}; 
        }
    }

    const knob = document.getElementById('joystick-knob');
    const joyContainer = document.getElementById('joystick-container');

    window.addEventListener('touchstart', e => {
        const touch = e.touches[0];
        const rect = joyContainer.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;
        
        if (Math.hypot(touch.clientX - centerX, touch.clientY - centerY) < 80) {
            joystick.active = true;
        }
    });

    window.addEventListener('touchmove', e => {
        if (!joystick.active) return;
        const touch = e.touches[0];
        const rect = joyContainer.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;
        
        let dx = touch.clientX - centerX;
        let dy = touch.clientY - centerY;
        const dist = Math.hypot(dx, dy);
        
        if (dist > 30) {
            dx = (dx / dist) * 30;
            dy = (dy / dist) * 30;
        }
        
        knob.style.transform = `translate(${dx}px, ${dy}px)`;
        joystick.x = dx / 8; // –ß—É—Ç—å —É–≤–µ–ª–∏—á–∏–ª —Å–∫–æ—Ä–æ—Å—Ç—å
        joystick.y = dy / 8;
    });

    window.addEventListener('touchend', () => {
        joystick.active = false;
        joystick.x = 0; joystick.y = 0;
        knob.style.transform = `translate(0px, 0px)`;
    });

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // –°—Ç–µ–Ω—ã (–Ω–µ–æ–Ω–æ–≤—ã–µ)
        ctx.fillStyle = '#1a1a2e';
        ctx.shadowBlur = 10; ctx.shadowColor = 'rgba(0, 243, 255, 0.3)';
        walls.forEach(w => ctx.fillRect(w.x, w.y, w.w, w.h));
        
        // –§–∏–Ω–∏—à (–ü—É–ª—å—Å–∏—Ä—É—é—â–∏–π –ø–æ—Ä—Ç–∞–ª)
        pulse = Math.sin(Date.now() / 200) * 10;
        ctx.fillStyle = '#bc13fe';
        ctx.shadowBlur = 20 + pulse; ctx.shadowColor = '#bc13fe';
        ctx.fillRect(finish.x - pulse/2, finish.y - pulse/2, finish.size + pulse, finish.size + pulse);
        
        // –ò–≥—Ä–æ–∫
        ctx.fillStyle = level === 5 ? '#ff003c' : '#00f3ff';
        ctx.shadowBlur = 15; ctx.shadowColor = ctx.fillStyle;
        ctx.beginPath();
        ctx.arc(player.x, player.y, player.radius, 0, Math.PI*2);
        ctx.fill();
        ctx.shadowBlur = 0;
    }

    function update() {
        if (!joystick.active) return;
        
        let nextX = player.x + joystick.x;
        let nextY = player.y + joystick.y;

        // –ö–æ–ª–ª–∏–∑–∏–∏ —Å–æ —Å—Ç–µ–Ω–∞–º–∏ –∏ –∫—Ä–∞—è–º–∏ —ç–∫—Ä–∞–Ω–∞
        let hit = false;
        if (nextX < 10 || nextX > canvas.width - 10 || nextY < 10 || nextY > canvas.height - 10) hit = true;
        
        walls.forEach(w => {
            if (nextX + 8 > w.x && nextX - 8 < w.x + w.w &&
                nextY + 8 > w.y && nextY - 8 < w.y + w.h) {
                hit = true;
            }
        });

        if (!hit) {
            player.x = nextX;
            player.y = nextY;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–Ω–∏—à–∞
        if (Math.hypot(player.x - (finish.x + finish.size/2), player.y - (finish.y + finish.size/2)) < 30) {
            if (level < 5) {
                level++;
                document.getElementById('cur-lvl').innerText = level;
                initLevel();
            } else {
                triggerScreamer();
            }
        }
    }

    function triggerScreamer() {
        bgAudio.pause();
        screamAudio.volume = 1.0;
        screamAudio.play().catch(e => console.log(e));
        screamerDiv.style.display = 'block';
        if (navigator.vibrate) navigator.vibrate([1000, 500, 2000]);
        // –§—É–ª–ª—Å–∫—Ä–∏–Ω –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞
        if (canvas.requestFullscreen) canvas.requestFullscreen();
    }

    function animate() {
        update();
        draw();
        requestAnimationFrame(animate);
    }

    window.addEventListener('resize', resize);
</script>

</body>
</html>
